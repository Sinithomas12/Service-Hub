{% extends 'user/base.html' %}
{% load static %}
{% block content %}

<style>
.booking-container {
    display: flex;
    align-items: flex-start;
    gap: 20px;
}

.search-box {
    width: 250px;
}

.search-box input {
    width: 100%;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #ccc;
    margin-bottom: 10px;
}

table {
    border-collapse: collapse;
    width: 100%;
}

th, td {
    text-align: center;
    padding: 8px;
    border-bottom: 1px solid #ddd;
}

tr:nth-child(even) {
    background-color: #D6EEEE;
}

.btn {
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    color: white;
    font-size: 12px;
    text-decoration: none;
}

.btn-cancel { background-color: #dc3545; }
</style>

<section class="w3l-team" id="team">
    <div class="team-block py-5">
        <div class="container py-lg-5">
            <div class="row justify-content-center text-left">
                <div class="col-md-12">
                    <h3 class="title-style mb-4">My Bookings</h3>
                    <div class="booking-container">
                        <!-- Search box -->
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="Search by worker or category">
                        </div>

                        <!-- Bookings table -->
                        <div style="flex:1;">
                            <table id="bookingTable">
                                <thead>
                                    <tr>
                                        <th>Worker Name</th>
                                        <th>Category</th>
                                        <th>Booking Date & Time</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for booking in bookings %}
                                    <tr>
                                        <td>{{ booking.worker.name }}</td>
                                        <td>{{ booking.worker.category.category }}</td>
                                        <td>
                                            {% if booking.bookingdatetime %}
                                                {{ booking.bookingdatetime|date:"d-m-Y H:i" }}
                                            {% else %}
                                                Not set
                                            {% endif %}
                                        </td>
                                        <td>â‚¹{{ booking.payment.amount }}</td>
                                        <td>{{ booking.status|title }}</td>
                                        <td>
                                            {% if booking.status != "cancelled" %}
                                            <a href="{% url 'cancelbooking' booking.id %}" class="btn btn-cancel"
                                               onclick="return confirm('Are you sure you want to cancel this booking?');">
                                                Cancel
                                            </a>
                                            {% else %}
                                                <span class="text-muted">Cancelled</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="6" class="text-center py-4">No bookings found.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div> <!-- booking-container -->
                </div>
            </div>
        </div>
    </div>
</section>

<script>
// JavaScript search/filter functionality
document.getElementById('searchInput').addEventListener('keyup', function() {
    var filter = this.value.toLowerCase();
    var rows = document.querySelectorAll('#bookingTable tbody tr');
    
    rows.forEach(function(row) {
        var worker = row.cells[0].textContent.toLowerCase();
        var category = row.cells[1].textContent.toLowerCase();
        if(worker.includes(filter) || category.includes(filter)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});
</script>

{% endblock %}
