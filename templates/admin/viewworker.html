{% extends 'admin/commonbase.html' %}
{% load static %}
{% block content %}

<!-- Styles -->
<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        text-align: center;
        padding: 6px;
    }

    tr:nth-child(even) {
        background-color: #D6EEEE;
    }

    img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 6px;
    }

    .btn-sm {
        padding: 4px 8px;
        font-size: 13px;
    }
</style>

<section class="w3l-team" id="team">
    <div class="team-block py-5">
        <div class="container py-lg-5">
            <div class="row justify-content-center text-center">
                <div class="col-md-8">
                    <div class="section-heading mb-sm-5 mb-4">
                        <h3 class="title-style mb-2" style="margin-top: -7%;">WORKERS LIST</h3><br>
                    </div>
                </div>
            </div>

            {% if abc %}
            <!-- Table -->
            <table id="workerTable" class="table table-bordered table-hover">
                <thead class="thead">
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Image</th>
                        <th>Experience</th>
                        <th>Location</th>
                        <th>Gender</th>
                        <th>Category</th>
                        <th>Wages</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    {% for i in abc %}
                    <tr>
                        <td>{{ i.name }}</td>
                        <td>{{ i.email }}</td>
                        <td>{{ i.phone }}</td>
                        <td><img src="{{ i.image.url }}" alt="worker image"></td>
                        <td>{{ i.experience }}</td>
                        <td>{{ i.location }}</td>
                        <td>{{ i.gender }}</td>
                        <td>{{ i.category }}</td>
                        <td>{{ i.wages }}</td>
                        <td>
                            {% if i.status == "pending" %}
                                <span class="badge bg-warning">Pending</span>
                            {% elif i.status == "approved" %}
                                <span class="badge bg-success">✔ Approved</span>
                            {% elif i.status == "rejected" %}
                                <span class="badge bg-danger">✘ Rejected</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="d-flex justify-content-center flex-wrap">
                                <!-- Edit Button -->
                                <button type="button" class="btn btn-primary btn-sm mx-1" data-bs-toggle="modal" data-bs-target="#editWorkerModal{{ i.id }}">
                                    Edit
                                </button>
                                <!-- Delete Button -->
                                <a href="/deleteworker/{{ i.id }}" class="btn btn-danger btn-sm mx-1"
                                   onclick="return confirm('Are you sure you want to delete this worker?');">Delete</a>
                            </div>
                        </td>
                    </tr>

                    <!-- Edit Modal -->
                    <div class="modal fade" id="editWorkerModal{{ i.id }}" tabindex="-1" aria-labelledby="editWorkerLabel{{ i.id }}" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <form method="POST" action="/editworker/{{ i.id }}/" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="modal-header">
                              <h5 class="modal-title" id="editWorkerLabel{{ i.id }}">Edit Worker</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                              <label>Name</label>
                              <input type="text" name="name" class="form-control" value="{{ i.name }}">
                              <label>Email</label>
                              <input type="email" name="email" class="form-control" value="{{ i.email }}">
                              <label>Phone</label>
                              <input type="text" name="phone" class="form-control" value="{{ i.phone }}">
                              <label>Experience</label>
                              <input type="text" name="experience" class="form-control" value="{{ i.experience }}">
                              <label>Location</label>
                              <input type="text" name="location" class="form-control" value="{{ i.location }}">
                              <label>Gender</label>
                              <select name="gender" class="form-control">
                                <option value="Male" {% if i.gender|default:'' == "Male" %}selected{% endif %}>Male</option>
                                <option value="Female" {% if i.gender|default:'' == "Female" %}selected{% endif %}>Female</option>
                                <option value="Other" {% if i.gender|default:'' == "Other" %}selected{% endif %}>Other</option>
                              </select>
                              <label>Wages</label>
                              <input type="number" name="wages" class="form-control" value="{{ i.wages }}">
                              <label>Category</label>
                              <input type="text" name="category" class="form-control" value="{{ i.category }}">
                              <label>Image</label>
                              <input type="file" name="image" class="form-control">
                            </div>
                            <div class="modal-footer">
                              <button type="submit" class="btn btn-success">Save</button>
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>

                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="alert alert-info text-center mt-4">
                <strong>No workers found!</strong>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Bootstrap JS (required for modal) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}
